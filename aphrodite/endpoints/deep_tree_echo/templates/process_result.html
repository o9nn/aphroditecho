{% extends "base.html" %}

{% block title %}DTESN Processing Result - Deep Tree Echo{% endblock %}

{% block header_title %}Processing Result{% endblock %}

{% block content %}
<div class="card">
    <h2>DTESN Processing Result</h2>
    <div class="status-badge {% if data.status == 'success' %}status-success{% elif data.status == 'error' %}status-error{% else %}status-warning{% endif %}">
        Status: {{ data.status|upper }}
    </div>
    
    <div style="margin-top: 1.5rem;">
        <h3>Processing Metrics</h3>
        <div class="code-block">
            <pre>Processing Time: {{ "%.2f"|format(data.processing_time_ms) }} ms
Membrane Layers: {{ data.membrane_layers }}
Server Rendered: {{ data.server_rendered }}
Timestamp: {{ timestamp }}</pre>
        </div>
    </div>
</div>

<div class="card">
    <h2>Result Data</h2>
    <div class="code-block">
        <h4>Processed Output</h4>
        <pre>{{ result_json }}</pre>
    </div>
</div>

{% if data.result.membrane_states is defined %}
<div class="card">
    <h2>Membrane States</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
        {% for layer, state in data.result.membrane_states.items() %}
        <div class="card" style="margin: 0;">
            <h3>{{ layer|title }}</h3>
            <p>Status: {{ state.status if state.status else 'Active' }}</p>
            <p>Nodes: {{ state.nodes if state.nodes else 'N/A' }}</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if data.result.esn_output is defined %}
<div class="card">
    <h2>ESN Reservoir Output</h2>
    <div class="code-block">
        <pre>{{ data.result.esn_output if data.result.esn_output else 'No ESN output available' }}</pre>
    </div>
</div>
{% endif %}

<div class="card">
    <h2>Processing Details</h2>
    <p>The DTESN system processed the input through {{ data.membrane_layers }} membrane layers in {{ "%.2f"|format(data.processing_time_ms) }} milliseconds.</p>
    
    {% if data.status == 'success' %}
    <p style="margin-top: 1rem; color: var(--success-color);">
        ✓ Processing completed successfully with full server-side rendering.
    </p>
    {% elif data.status == 'error' %}
    <p style="margin-top: 1rem; color: var(--error-color);">
        ✗ Processing encountered an error. Check the result data for details.
    </p>
    {% endif %}
</div>

<div class="card">
    <h2>Actions</h2>
    <a href="/deep_tree_echo/" style="color: var(--accent-color); text-decoration: none;">← Back to Home</a> |
    <a href="/deep_tree_echo/process" style="color: var(--accent-color); text-decoration: none;">Process New Input</a> |
    <a href="/deep_tree_echo/status" style="color: var(--accent-color); text-decoration: none;">System Status</a>
</div>
{% endblock %}