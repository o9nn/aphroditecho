# DTESN Server-Side Cache Configuration Example
# Copy to .env and customize for your deployment

# =============================================================================
# Core Cache Settings
# =============================================================================

# Enable/disable DTESN caching (default: true)
DTESN_CACHE_ENABLED=true

# Cache strategy: aggressive, balanced, conservative, dynamic (default: balanced)
DTESN_CACHE_STRATEGY=balanced

# Maximum entries in L1 memory cache (default: 1000)
DTESN_CACHE_MAX_MEMORY_ENTRIES=1000

# Maximum entries in L2 compressed cache (default: 5000)
DTESN_CACHE_MAX_COMPRESSED_ENTRIES=5000

# Default TTL for cache entries in seconds (default: 3600 = 1 hour)
DTESN_CACHE_DEFAULT_TTL_SECONDS=3600

# =============================================================================
# Redis Configuration (Optional - for distributed caching)
# =============================================================================

# Redis connection URL for L3 distributed cache
# Leave empty to disable Redis caching
DTESN_CACHE_REDIS_URL=redis://localhost:6379

# Example Redis configurations:
# Local Redis: redis://localhost:6379
# Redis with auth: redis://:password@localhost:6379
# Redis cluster: redis://redis-cluster:6379
# Disable Redis: (leave empty or comment out)

# =============================================================================
# Compression Settings
# =============================================================================

# Enable compression for cache entries (default: true)
DTESN_CACHE_COMPRESSION_ENABLED=true

# Minimum size in bytes to trigger compression (default: 1024)
DTESN_CACHE_COMPRESSION_THRESHOLD=1024

# =============================================================================
# Environment-Specific Configurations
# =============================================================================

# Development Environment
# DTESN_CACHE_STRATEGY=aggressive
# DTESN_CACHE_MAX_MEMORY_ENTRIES=2000
# DTESN_CACHE_DEFAULT_TTL_SECONDS=7200
# DTESN_CACHE_REDIS_URL=

# Production Environment (High Performance)
# DTESN_CACHE_STRATEGY=balanced
# DTESN_CACHE_MAX_MEMORY_ENTRIES=5000
# DTESN_CACHE_MAX_COMPRESSED_ENTRIES=20000
# DTESN_CACHE_DEFAULT_TTL_SECONDS=3600
# DTESN_CACHE_REDIS_URL=redis://redis-cluster:6379

# Memory-Constrained Environment
# DTESN_CACHE_STRATEGY=conservative
# DTESN_CACHE_MAX_MEMORY_ENTRIES=500
# DTESN_CACHE_MAX_COMPRESSED_ENTRIES=1000
# DTESN_CACHE_DEFAULT_TTL_SECONDS=1800
# DTESN_CACHE_COMPRESSION_THRESHOLD=512

# Testing Environment (Aggressive Caching)
# DTESN_CACHE_STRATEGY=aggressive
# DTESN_CACHE_MAX_MEMORY_ENTRIES=10000
# DTESN_CACHE_DEFAULT_TTL_SECONDS=14400
# DTESN_CACHE_REDIS_URL=redis://test-redis:6379

# =============================================================================
# Performance Tuning Notes
# =============================================================================

# Cache Strategy Selection:
# - aggressive: Cache everything with long TTL (2x default)
#   Best for: Development, testing, stable datasets
#
# - balanced: Cache frequent requests with normal TTL
#   Best for: Production environments (recommended)
#
# - conservative: Cache only expensive operations with short TTL (0.5x default)
#   Best for: Memory-constrained systems, highly dynamic data
#
# - dynamic: Adaptive TTL based on processing time
#   Best for: Variable workloads, mixed processing complexity

# Memory Usage Guidelines:
# - Each memory entry uses ~2-10KB depending on DTESN result size
# - Compressed entries use ~30-70% less space
# - Redis entries persist across restarts
# - Monitor memory usage with /v1/dtesn/cache/metrics endpoint

# TTL Guidelines:
# - Short TTL (300-900s): Highly dynamic data, frequent model updates
# - Medium TTL (1800-3600s): Standard production workloads
# - Long TTL (7200-14400s): Stable data, expensive computations
# - Very long TTL (86400s+): Static analysis, reference data

# =============================================================================
# Redis Production Configuration
# =============================================================================

# For production Redis deployments, consider:
# - Redis Cluster for high availability
# - Authentication and TLS encryption
# - Memory limits and eviction policies
# - Monitoring and alerting

# Example production Redis URL with auth:
# DTESN_CACHE_REDIS_URL=redis://:your_secure_password@redis-prod:6379

# Example Redis Sentinel configuration:
# DTESN_CACHE_REDIS_URL=redis-sentinel://sentinel1:26379,sentinel2:26379/mymaster

# =============================================================================
# Monitoring Integration
# =============================================================================

# The cache automatically integrates with:
# - Echo.Dash dashboard for real-time metrics
# - Echo.Kern performance monitoring
# - Prometheus metrics (if enabled)
# - Custom logging and alerting

# Monitor cache performance at:
# GET /v1/dtesn/cache/metrics
# GET /v1/dtesn/cache/status

# =============================================================================
# Security Considerations
# =============================================================================

# In production environments:
# 1. Use Redis authentication: DTESN_CACHE_REDIS_URL=redis://:password@host:port
# 2. Enable Redis TLS/SSL if handling sensitive data
# 3. Implement proper network security (VPC, firewalls)
# 4. Consider cache encryption for sensitive DTESN results
# 5. Audit cache access patterns and implement rate limiting

# =============================================================================
# Debugging and Development
# =============================================================================

# For debugging cache issues:
# 1. Enable debug logging: Set log level to DEBUG for dtesn_cache_manager
# 2. Use test script: python test_cache_standalone.py
# 3. Monitor metrics: watch -n 5 'curl -s localhost:8000/v1/dtesn/cache/metrics'
# 4. Check Redis directly: redis-cli monitor (if using Redis)

# Development shortcuts:
# - Set very short TTL to test expiration: DTESN_CACHE_DEFAULT_TTL_SECONDS=60
# - Use small cache sizes to test eviction: DTESN_CACHE_MAX_MEMORY_ENTRIES=10
# - Disable Redis for local development: # DTESN_CACHE_REDIS_URL=